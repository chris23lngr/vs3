---
title: Multipart Uploads
description: How multipart uploads work in vs3 and how to use them from the client.
---

Multipart upload splits a large file into smaller parts, uploads those parts in parallel, then completes the upload in S3.

Use this when uploading large files where single-request uploads are slower or more likely to fail.

## Flow

`vs3` multipart uploads use this sequence:

1. `POST /multipart/create` creates the upload session and returns `{ uploadId, key }`.
2. `POST /multipart/presign-parts` returns presigned URLs for part numbers.
3. The client uploads parts directly to S3 with concurrent XHR `PUT` requests.
4. `POST /multipart/complete` finalizes the upload with part numbers and ETags.
5. If any step fails, `vs3` attempts `POST /multipart/abort` as best-effort cleanup.

## Client Hook

Use `useMultipartUpload` from your framework client.

<CodeTabs defaultValue="react" values={["react", "vue"]}>
<CodeTabsContent value="react">
```ts
const { upload, abort, reset, state } = storageClient.useMultipartUpload({
	partSize: 8 * 1024 * 1024, // 8 MB
	concurrency: 4,
	onProgress: (progress) => {
		console.log(Math.round(progress * 100));
	},
});

await upload(file, { userId: "123" });
```
</CodeTabsContent>
<CodeTabsContent value="vue">
```ts
const { upload, abort, reset, state } = storageClient.useMultipartUpload({
	partSize: 8 * 1024 * 1024, // 8 MB
	concurrency: 4,
	onProgress: (progress) => {
		console.log(Math.round(progress * 100));
	},
});

await upload(file, { userId: "123" });
```
</CodeTabsContent>
</CodeTabs>

The hook state includes:

- `progress` as a number from `0` to `1`
- `status` as `"idle" | "loading" | "success" | "error"`
- `data` with `{ key, uploadId, totalParts }` on success
- `error` with structured storage errors on failure

## Defaults

If you do not set options, multipart upload uses:

- `partSize`: `10 * 1024 * 1024` bytes (10 MB)
- `concurrency`: `4`
- Presign batching: up to `10` part URLs per request to `/multipart/presign-parts`

## Error Cases

Common multipart errors you should handle:

- `INVALID_FILE_INFO` when file is empty, `partSize` is invalid, or `concurrency` is invalid
- `METADATA_VALIDATION_ERROR` when metadata does not match your `metadataSchema`
- `MULTIPART_UPLOAD_NOT_FOUND` when upload session is expired or missing
- `MULTIPART_UPLOAD_FAILED` when presigning, completing, or aborting multipart operations fails

For UI behavior, prefer using `state.status`, `state.error`, and `state.progress` from the hook.
